
%% Before you have any solutions
% myLoc = [25175.6, -21589.2, 3195.317]; % Team 40 - can't hit with air resistance
myLoc = [-19908.5, -10564.6, 6923.286]; % sample firing location (Team 39)
Target = plotScene(myLoc) % find the target coordinates

%% When you have only one solution (w/o air resistance)
%sample trajectory data Traj1, [x, y, z] for drag-free path:
v0=1250;
xt=3801.5;
yt=3484.5;
zt=8000;

xc=-19908.5;
yc=-10564;
zc=6923.286;

th=atand((yt-yc)/(xt-xc));
ph=72.4484

T=0:.005:73.1105
x=@ (t) xc+v0.*t.*cosd(ph).*cosd(th);
y=@ (t) yc+v0.*t.*cosd(ph).*sind(th);
z=@ (t) zc+v0.*t.*sind(ph)-0.5.*32.2.*t.^2;
Traj1 = [x(T);y(T);z(T)]'

plotScene(myLoc,Traj1); % plot the scene with the first solution

%% When you have both solutions (w/ and w/o air resistance)
% sample trajectory data Traj2, [x,y,z] for air resistance path
Traj2 = [-20797.9000000000,11350.6500000000,14541.7500000000;-20286.0859482567,11186.9872235453,15360.4552879420;-19786.3253450882,11027.1787782737,16139.5283917668;-19297.8613560113,10870.9826512268,16880.6302159922;-18819.9974807765,10718.1761225237,17585.2793765147;-18352.0927991891,10568.5542451174,18254.8637983673;-17893.5553718329,10421.9277345441,18890.6561170798;-17443.8373633624,10278.1214094983,19493.8244047127;-17002.4318342339,10136.9731659252,20065.4406676501;-16568.8677045945,9998.33236662261,20606.4921414516;-16142.7071120101,9862.05899632259,21117.8872691594;-15723.5431439869,9728.02293661930,21600.4620840051;-15310.9962461561,9596.10281741429,22054.9883374572;-14904.7123835538,9466.18542894914,22482.1776515816;-14504.3616669853,9338.16528255796,22882.6857675605;-14109.6362303163,9211.94393188870,23257.1179738890;-13720.2482175064,9087.42932921690,23606.0338065516;-13335.9292584699,8964.53565784178,23929.9487434830;-12956.4293663463,8843.18297946636,24229.3381217183;-12581.5154852722,8723.29676981854,24504.6411998483;-12210.9705771262,8604.80762661940,24756.2638638177;-11844.5934050563,8487.65120036196,24984.5797432276;-11482.1978604687,8371.76797910217,25189.9335615204;-11123.6123105074,8257.10307980268,25372.6438894334;-10768.6789559206,8143.60604299757,25533.0062750031;-10417.2538022745,8031.23082358764,25671.2934422529;-10069.2063515677,7919.93569222763,25787.7584451914;-9724.41948610951,7809.68319819428,25882.6361033489;-9382.78883158366,7700.43996571306,25956.1473214452;-9044.22259279692,7592.17664143554,26008.5003414507;-8708.64150886211,7484.86788010828,26039.8910020543;-8375.97843087578,7378.49220952680,26050.5066647507;-8046.17832883763,7273.03203274820,26040.5273028242;-7719.19702682060,7168.47322363654,26010.1296027777;-7395.00096864327,7064.80505193189,25959.4879381778;-7073.56716722974,6962.02016705709,25888.7744862265;-6754.88206992248,6860.11423527894,25798.1626251796;-6438.94136740414,6759.08587860704,25687.8281769544;-6125.74815680345,6658.93608741024,25557.9515660876;-5815.31240363417,6559.66804836081,25408.7187467511;-5507.65094168669,6461.28714439981,25240.3212028462;-5202.78633874823,6363.80059202844,25052.9571597148;-4900.74561383598,6267.21703111767,24846.8331914381;-4601.55948106720,6171.54628312059,24622.1639184744;-4305.26146632020,6076.79906860715,24379.1725172389;-4011.88790006660,5982.98700497203,24118.0907192933;-3721.47690620621,5890.12228309446,23839.1588520635;-3434.06754084798,5798.21739194620,23542.6259677215;-3149.69918352584,5707.28492392058,23228.7491937567;-2868.41107806538,5617.33742801548,22897.7935603746;-2590.24233072590,5528.38740923923,22550.0319978311;-2315.23126059920,5440.44712088760,22185.7446259947;-2043.41471664936,5353.52834615362,21805.2182787621;-1774.82789826709,5267.64234074626,21408.7455684376;-1509.50407206976,5182.79974233158,20996.6243029139;-1247.47457190141,5099.01057053271,20569.1574856719;-988.768783780583,5016.28422211662,20126.6532740600;-733.413447938868,4934.62924780703,19669.4230894578;-481.432527169692,4854.05331018626,19197.7809296333;-232.847444028751,4774.56325954482,18712.0434044178;12.3230425195082,4696.16509443666,18212.5292715773;254.063023916594,4618.86390194145,17699.5584364249;492.359467570848,4542.66384949094,17173.4512729756;727.202112163434,4467.56821834702,16634.5283212478;958.583489229201,4393.57939670072,16083.1099750896;1186.49902826569,4320.69884606161,15519.5153496365;1410.94690460920,4248.92714990237,14944.0620604059;1631.92796171894,4178.26403851007,14357.0660361286;1849.44574500293,4108.70837816960,13758.8407866754;2063.50645563697,4040.25818593101,13149.6967663456;2274.11873151125,3972.91069965620,12529.9413713385;2481.29361655818,3906.66238782697,11899.8788204689;2685.04458414362,3841.50894206520,11259.8091459358;2885.38739408029,3777.44532285565,10610.0279757543;3082.33986479712,3714.46583239941,9950.82671025431;3275.92185164049,3652.56412155248,9282.49246319240;3466.15523004073,3591.73319520862,8605.30711459944;3653.06380291556,3531.96544190898,7919.54702563389;3836.67300940141,3473.25272698103,7225.48351606167;4017.00990127473,3415.58640007836,6523.38287550232;4194.10310355264,3358.95730777943,5813.50585884419;4367.98277254734,3303.35580700044,5096.10688801156;4538.68033617519,3248.77184803676,4371.43480944943;4706.22840934418,3195.19500161944,3639.73299505718;4870.66077181597,3142.61446599428,2901.23913173467;5032.01230647393,3091.01908666187,2156.18444240624;5190.31882170666,3040.39741317399,1404.79431852029;5345.61694913997,2990.73773183584,647.288547670588;5497.94412003859,2942.02807325213,-116.118902033094;5647.33849064453,2894.25623620155,-885.220332806026;5793.83879985354,2847.40983314764,-1659.81371713981;5937.48431510090,2801.47630754283,-2439.70259801141;6078.31478805346,2756.44294799683,-3224.69642997300;6216.37035688247,2712.29691952685,-4014.61037890175;6351.69146878959,2669.02528833145,-4809.26498527618;6484.31884505778,2626.61503296620,-5608.48636113079;6614.29341583617,2585.05306519754,-6412.10623258457;6741.65622676225,2544.32625986220,-7219.96141318098;6866.44842139522,2504.42146048448,-8031.89383110320;6988.71118809920,2465.32549626143,-8847.75079005857;7108.48569246809,2427.02520367131,-9667.38451780896];
plotScene(myLoc,Traj1,Traj2); % plot the scene with two solutions

function BTarget = plotScene(ML, data1, data2)
% ML = [x,y,z] coordinates of launcher
% data1 [x1, y1, z1; x2, y2, z2; ... ], trajectory of theoretical solution
% data2 [x1, y1, z1; x2, y2, z2; ... ], trajectory of modified simulation

%% Generate Surface
s = @(x,y,a,b,c) exp(-a*(x-c(1)).^2 - b*(y - c(2)).^2);
bounds = 5*5280*[-1 1 -1 1];
ctr = [mean(bounds([1 2])); mean(bounds([3 4]))];
rng = [range(bounds([1 2])); range(bounds([3 4]))]/2;

% surface parameters
a = [7.19943956594861e-08,3.70225998675864e-08,4.28821477173377e-08,8.34132683009646e-08,5.77170831287080e-08,1.03579529090765e-07,5.26113554372298e-08,4.36707678628294e-08,7.82992472366750e-08,9.60082925794504e-08,8.05248316953032e-08,9.57576022580273e-08,9.59798955335062e-08,3.79330707609016e-08,7.18221713591951e-08,1.07255009752649e-07,4.38395728897611e-08,7.93614376954868e-08,6.01984334696975e-08,6.93745503466942e-08,1.00110612521088e-07,1.05703170456373e-07,5.23148185155313e-08,1.03796033937238e-07,4.82082864817357e-08,4.43577601437802e-08,7.00677300243393e-08,6.04368361076049e-08,4.20526493715021e-08,9.55146485111298e-08,8.61729248419933e-08,8.78637761562836e-08,5.21998483206275e-08,6.12897262014716e-08,6.62672708778837e-08,6.42478680155733e-08,9.81052375546858e-08,8.34527813148177e-08,5.97364008185879e-08,4.24985687118054e-08,4.80803175140601e-08,5.36059085048500e-08,5.18146337035862e-08,4.62318535310210e-08,1.00276639753178e-07,1.03955149997245e-07,9.24696738406323e-08,7.60113967851821e-08,1.05721651803442e-07,4.16751365042201e-08,4.32825182809933e-08,8.43515080401210e-08,9.21443524507263e-08,7.78641887452015e-08,4.85319690216564e-08,1.03222292003591e-07,5.58754108514408e-08,4.94687863906976e-08,5.13876650654852e-08,8.48312887499403e-08,7.42985981401410e-08,4.90345885338812e-08,8.92871313285477e-08,9.14670304119124e-08,6.83776992946750e-08,5.70247369515290e-08,7.34906927546024e-08,1.05315110557512e-07,7.31475312365822e-08,1.01903665986178e-07,5.21770722587543e-08,5.53273006451260e-08,4.67655943921751e-08,1.01970472117306e-07,9.69635129265306e-08,3.71573495783541e-08,6.14673457143656e-08,9.92365317706678e-08,6.92215607911066e-08,9.60288610356581e-08,4.68357716562705e-08,6.55745425606102e-08,8.47868271661262e-08,9.73670986608834e-08,7.93383466267310e-08,4.01590214480431e-08,7.46876232858931e-08,7.75899588125860e-08,1.00916941241445e-07,7.46387524625768e-08,5.98119234519608e-08,6.04065615433248e-08,7.06766665483734e-08,8.79419314702837e-08,8.54299043972514e-08,7.78172298427292e-08,4.76347585666319e-08,6.75356161524565e-08,4.01988025454218e-08,8.58138748117464e-08];
b = [6.40468109747247e-08,6.81546865425349e-08,8.24478458523272e-08,5.95045626983029e-08,9.03699801571862e-08,4.39503668382315e-08,7.01051005347769e-08,6.73841280016556e-08,5.56160264885115e-08,1.00177637447233e-07,9.74712452854561e-08,9.39847151193369e-08,8.07826839737261e-08,5.61807543233447e-08,5.90886249292857e-08,1.03587066194329e-07,9.87801506098889e-08,4.55927139447144e-08,5.94242653757921e-08,5.48591201088978e-08,1.01241978863527e-07,9.16201787094317e-08,9.19293245854712e-08,4.92973134230335e-08,8.78200000242083e-08,3.59100556407368e-08,5.85440232240574e-08,5.05123342846331e-08,6.59502870194589e-08,9.72087541202314e-08,1.03187196450809e-07,6.27074850028654e-08,7.90167967962692e-08,4.66927577967662e-08,5.53709562744573e-08,3.76717793611367e-08,9.76672655794203e-08,5.69780788135525e-08,3.82952353140136e-08,9.53787292479272e-08,9.28638866839134e-08,9.45967635575892e-08,7.90003188434527e-08,5.26484374102135e-08,1.03903480279254e-07,1.03277713709522e-07,9.28588570521051e-08,8.61917135093257e-08,5.39987546971204e-08,9.21728954777861e-08,1.03469418371555e-07,4.38089918932102e-08,6.47264045015998e-08,6.61022682920973e-08,1.01877245122663e-07,9.54252777182865e-08,5.73883439021033e-08,7.15522092061384e-08,7.48136326061868e-08,8.69448904595217e-08,7.51206760560440e-08,5.89343484631706e-08,5.65144623141182e-08,8.69159349238627e-08,7.12534997350357e-08,9.59696293170153e-08,7.24831379016982e-08,6.12148653620916e-08,8.66484420158318e-08,4.94551889641201e-08,5.42735284470107e-08,6.06370275542983e-08,9.28522196870802e-08,9.16232621829412e-08,8.97698662052739e-08,8.71562091354754e-08,5.78784340661408e-08,6.53614368925219e-08,1.03794944543236e-07,4.73669052843620e-08,8.39808617860807e-08,8.29000801894874e-08,1.05346929667657e-07,1.06378018130050e-07,8.82792098734392e-08,8.04017776852553e-08,9.71164865264770e-08,8.40223414172562e-08,6.49352410094517e-08,9.70394436887164e-08,3.95133525192804e-08,8.95460672224830e-08,7.70488846581512e-08,6.43568811915494e-08,6.91574191890188e-08,5.35611920698759e-08,5.06253297149641e-08,4.52413215749076e-08,5.45238779714596e-08,7.57250879900508e-08];
c = [21400.2147213727,10323.9419889198,6729.22221894404,-11592.3523647173,2491.91132796502,19356.0479422356,-16312.1096385861,1999.86753241840,-4307.14495145207,-702.569814074026,20631.3865106468,15714.6649401179,-15470.8820219562,6459.13902912259,20881.7893731574,15173.7930202353,14153.8205573526,3578.06457342035,-15075.3788999149,20600.2862939738,-17962.6102885461,24075.0836794958,24543.1326898011,6383.57163516417,4546.79022476905,21343.1914421194,-19711.6735026131,3940.55861132794,7459.89773572618,5335.30366649904,-16427.9415625354,10675.0684370842,-24994.0162226597,-2825.45408441921,10827.3502137514,24262.9581462588,-6393.22720775370,-20936.9464147122,12288.0553436238,22554.1191474153,-6377.50327230322,2509.80657781985,-13388.8206553215,15058.3119092366,-10596.9303894072,12330.9573072331,-7835.71860200980,17258.9744533099,-1792.15897789137,-16892.7211603476,-15496.0675316300,-3485.44246955820,7685.63439831365,-24533.9933430490,-9162.77656529991,-2375.77014024118,-3491.65312321741,19917.6263747530,1534.77608173574,-1060.43319903172,17037.7414235382,-17857.8558544825,-21435.2999323890,-25293.2437161238,-7778.58243406405,-8040.13604619079,3833.08473758324,-16687.8028067165,21418.3140337651,-13816.1744024915,-9641.81417664644,-15682.7984733603,23568.1492230346,-13242.9532251356,-17085.3877986279,22406.0983071794,9178.40796004609,114.345218658748,-21107.6182709588,-14088.5028304558,20942.1127129373,-5383.82244974409,-11083.9396297806,16693.9205187291,-23853.7341061593,-17677.9109468308,-3579.29152027729,17790.3847952411,20520.0568886068,-14647.6966274968,-2146.77267887267,6589.13482324456,15860.4476303758,-5869.35249975358,14208.3575398388,-21204.7112563350,-21249.5823346964,-13463.9639758782,-2800.31061949351,-24129.5607509479;
     -13549.1963183855,10874.0102957330,-18534.9235574099,-4672.45516482217,14668.9065112011,18463.9539245604,21858.4910560919,-23803.4951134864,-45.6829575866479,-13161.2699799297,-18106.0952251368,19979.7875487502,-6525.10342213946,-20946.7226365833,10665.1102597297,6429.70879586324,9771.91865861907,-8113.87750194120,-6769.82497145225,-23738.5497435579,4453.75126762278,-13887.1329693855,-14535.6011445414,19143.7720667645,-2309.03292415003,-18014.5012636961,9104.04013355441,2231.96096723453,-19747.6457337083,16007.2071266350,21338.9628141189,-16719.6687583179,14826.0878190445,18421.0629419465,9431.77143437388,-1431.62010946515,-6552.33012620316,-25287.4981261355,-3001.55654201149,17041.2157796566,20717.7136036425,-15700.5423312040,21279.4683816829,19587.1567705310,-26.6410568767181,-7905.51271538944,-8752.05794228052,-1733.26197740745,-24534.6211738114,-9187.46636606296,-3635.10955752970,17674.6089666956,5845.46638581712,8408.89804491359,-11500.8600165449,-4985.45287870256,-3177.31444641453,-16407.7980992850,13412.3647500529,-11405.8527101320,10129.9434874608,12770.8556705084,4327.27011735318,-15325.7111893657,5908.22890596655,24825.0975328023,20771.9942925488,3435.15075032834,19901.6095443558,2028.91091029637,-19378.4436133129,-22623.7204299693,-7844.24683061883,1673.91515783334,17223.6747204730,2897.84750939603,-23434.4070690887,-7537.51803488902,-9526.94116350040,-17749.5539806642,9231.98760559468,4515.94963301090,-25568.4769560084,-16397.3050520880,15429.4215098586,-9011.63521480798,4119.40745839252,7096.57671141900,3962.67755427504,7233.87394338464,19304.2177978668,12043.4136937970,-2659.88309505952,5593.29546147299,-8714.69024191814,-4761.52832771713,14262.9412515698,19344.0333960805,9248.31628843764,-17603.7830312224];
d = [815.100181297528,1609.96454319456,707.243511402796,2987.46673022511,2754.71382601655,1032.96174939344,1105.50945531081,1930.02092161488,2146.02853204357,532.257133347649,2088.55897303466,1405.02661415459,2480.66573556542,1294.53606540888,421.932111754080,3327.48864574245,2517.37481255018,2373.93181971418,1543.77257541524,1571.99809876895,1564.19307394081,222.987797762633,3096.85289481289,1080.84950196440,1588.38558494747,2961.26698946713,3202.87411506781,1320.79893179602,2392.36030364173,2537.96138127955,3232.08230048686,3290.23817010669,1046.59701563662,3157.50512551885,2721.85118088260,3096.78476095851,2154.42480396289,520.059335845187,1415.16397945518,411.583326289749,2199.45023892536,3026.73334739673,2229.70806073780,1938.48042344877,1377.83733815763,1185.10076691598,1419.10261955109,633.513488020588,467.686228031941,1034.16108319481,176.607300747599,338.728290537908,50.6148350223872,2725.34876631591,2457.08820805957,3460.66129070452,1677.46747959596,22.4982859560073,2255.98971526811,413.724714148583,2478.30567303806,1983.50729341992,298.185707490951,2370.85575463660,1599.04319107723,1408.66080839772,1312.15053537126,2426.78006136247,936.651445234245,468.075000339212,573.999324761675,3057.18265512584,206.237181424485,257.594626320030,117.926432618864,2900.95148192099,1143.83133549476,3460.95601686342,1380.15425820212,1990.05506092793,2302.82258655615,2841.15457403263,1435.44263279188,139.060096679760,1383.48635208054,944.803875047801,477.672540692045,741.353800526301,58.4835260560299,2493.68577237298,2715.50081214194,2345.40813188055,966.056580022642,65.0747842818783,567.282745114666,2881.16983493994,3446.51530688866,230.024940654098,915.197987840457,2053.37125365990];
f = @(x,y) 0;
for m = 1:length(a)
    e = 1.5;% make the mountains a bit higher
    f = @(x,y) f(x,y) + e*d(m)*s(x,y,a(m),b(m),c(:,m));
end

%% Build the Bridge
Bh = 8000;
B = [0, -1901, Bh; 7603, 8870, Bh];
Bx = @(t) B(1,1)*(1-t)+B(2,1)*t; % mapping of x coordinate along t
By = @(t) B(1,2)*(1-t)+B(2,2)*t; % mapping of y coordinate along t
Bz = @(t)  -4*0.8*Bh*t.*(t-1); % mapping of arch height along t
BTarget = mean(B,1);
Bt = linspace(0,1,101)';
Bav = [Bx(Bt), By(Bt), Bz(Bt)];
Bts = (0.5+(-2:2)*0.2)';
Bs = [Bx(Bts), By(Bts), Bh + 0*Bts, Bz(Bts)];

%% Generate random firing location - disabled
% r = 0;
% while r < 10000
%   ML = ctr + rng.*(2*rand(2,1) - 1); % mortar location
%   ML(3) = 1.5*f(ML(1),ML(2));
%   view_angle = atan2d(BTarget(2)-ML(2),BTarget(1)-ML(1));
%   r = norm(ML(1:2) - BTarget(1:2));
% end

%% Generate Plot
pr = 1.2; % plot extra region around the mountains
view_angle = atan2d(BTarget(2)-ML(2),BTarget(1)-ML(1)); % determine best view angle
[xm,ym] = meshgrid(linspace(1.2*bounds(1),1.2*bounds(2),101),linspace(1.2*bounds(3),1.2*bounds(4),101));
zm = f(xm,ym);

% Set the Scene
figure(200)
subplot(1,1,1,'fontname','times new roman','fontsize',12)
cla;hold on
surf(xm,ym,1.5*zm,'linestyle','none');
plot3(B(:,1),B(:,2),B(:,3),'ks','linewidth',3);
plot3(B(:,1),B(:,2),B(:,3),'k-','linewidth',3);
plot3(Bav(:,1),Bav(:,2),Bav(:,3),'k-','linewidth',3);
plot3((Bs(:,1).*[1 1])', (Bs(:,2).*[1 1])', Bs(:,3:4)','k-','linewidth',2);
plot3(BTarget(1),BTarget(2),BTarget(3),'ro','linewidth',2,'markersize',20);
plot3(BTarget(1),BTarget(2),BTarget(3),'r+','linewidth',1,'markersize',20);
plot3(ML(1),ML(2),ML(3),'b^','linewidth',2,'markersize',12);
hold off
axis equal
xlabel('x');ylabel('y')
view(view_angle,50)

% Surface Colors
mycolors = [0 0.2 0;
            0.5 0.5 0.5];
Ncol = 50;
tcol = linspace(0,1,Ncol)';
vcol = @(a,b) a + (b-a)*(tanh(5*(tcol - 0.4))+1)/2;
mycolors = [vcol(mycolors(1,1),mycolors(2,1)), ...
            vcol(mycolors(1,2),mycolors(2,2)), ...
            vcol(mycolors(1,3),mycolors(2,3))];
colormap(mycolors)

%% Animate Theoretical & Simulated Trajectories
if nargin >= 2 % first dataset
  hold on
  if data1(1,:) > 3
      data1 = data1';
  end
  plot3(data1(:,1),data1(:,2),data1(:,3),'y-','linewidth',1)
  hold off
end

if nargin >= 3 % second dataset
  if data2(1,:) > 3
    data2 = data2';
  end
  hold on
  plot3(data2(:,1),data2(:,2),data2(:,3),'--','color',[0.7 0.4 0],'linewidth',2)
  hold off
end
end
